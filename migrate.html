<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–∏–≥—Ä–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö Supabase</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .log {
            background: #1a1a1a;
            color: #00ff00;
            padding: 20px;
            border-radius: 5px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 12px;
            height: 400px;
            overflow-y: auto;
            margin: 20px 0;
        }
        button {
            background: #4CAF50;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            background: #45a049;
        }
        button:disabled {
            background: #cccccc;
            cursor: not-allowed;
        }
        .error {
            color: #ff4444;
        }
        .success {
            color: #00ff00;
        }
        .warning {
            color: #ffaa00;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ –ú–∏–≥—Ä–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö Car Expense Tracker</h1>
        <p>–≠—Ç–æ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç –º–∏–≥—Ä–∞—Ü–∏—é –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≤–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ Supabase.</p>
        
        <div>
            <button onclick="runMigrations()" id="migrateBtn">–ó–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é</button>
            <button onclick="clearLog()">–û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥</button>
        </div>
        
        <div id="log" class="log"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        const SUPABASE_URL = 'https://xixjtczhnyggwotkvbhh.supabase.co'
        const SUPABASE_SERVICE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhpeGp0Y3pobnlnZ3dvdGt2YmhoIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1ODcwNTc1NiwiZXhwIjoyMDc0MjgxNzU2fQ.YYbstDN7VYEG2RW2cNir68B3MZ54AproGN94iedJZGg'

        const { createClient } = supabase
        const supabaseClient = createClient(SUPABASE_URL, SUPABASE_SERVICE_KEY)
        
        function log(message, type = 'info') {
            const logElement = document.getElementById('log')
            const timestamp = new Date().toLocaleTimeString()
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : type === 'warning' ? 'warning' : ''
            logElement.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`
            logElement.scrollTop = logElement.scrollHeight
        }
        
        function clearLog() {
            document.getElementById('log').innerHTML = ''
        }
        
        async function executeSQL(sql, description) {
            log(`üìÑ ${description}`)
            try {
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä—è–º–æ–π HTTP –∑–∞–ø—Ä–æ—Å –∫ Supabase REST API
                const response = await fetch(`${SUPABASE_URL}/rest/v1/rpc/exec`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${SUPABASE_SERVICE_KEY}`,
                        'apikey': SUPABASE_SERVICE_KEY,
                        'Prefer': 'return=minimal'
                    },
                    body: JSON.stringify({ sql: sql.trim() })
                })

                if (!response.ok) {
                    const errorText = await response.text()
                    log(`‚ùå HTTP ${response.status}: ${errorText}`, 'error')
                    return false
                }

                log(`‚úÖ ${description} - –≤—ã–ø–æ–ª–Ω–µ–Ω–æ`, 'success')
                return true
            } catch (err) {
                log(`‚ùå –ò—Å–∫–ª—é—á–µ–Ω–∏–µ: ${err.message}`, 'error')
                return false
            }
        }
        
        async function runMigrations() {
            const btn = document.getElementById('migrateBtn')
            btn.disabled = true
            btn.textContent = '–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è...'
            
            log('üöÄ –ù–∞—á–∏–Ω–∞–µ–º –º–∏–≥—Ä–∞—Ü–∏—é –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö...', 'success')
            
            try {
                // –°–æ–∑–¥–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é exec
                log('üîß –°–æ–∑–¥–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é exec...')
                await executeSQL(`
                    CREATE OR REPLACE FUNCTION exec(sql text)
                    RETURNS void
                    LANGUAGE plpgsql
                    SECURITY DEFINER
                    AS $$
                    BEGIN
                        EXECUTE sql;
                    END;
                    $$;
                `, '–°–æ–∑–¥–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ exec')
                
                // –ú–∏–≥—Ä–∞—Ü–∏—è 1: –û—Å–Ω–æ–≤–Ω–∞—è —Å—Ö–µ–º–∞
                log('üìä –°–æ–∑–¥–∞–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã...')
                await executeSQL(\`
-- –°–æ–∑–¥–∞–Ω–∏–µ enum —Ç–∏–ø–æ–≤
CREATE TYPE user_role AS ENUM ('owner', 'investor', 'assistant');
CREATE TYPE car_status AS ENUM ('active', 'sold');
CREATE TYPE transaction_type AS ENUM ('income', 'expense');

-- –¢–∞–±–ª–∏—Ü–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    email TEXT UNIQUE NOT NULL,
    full_name TEXT,
    role user_role NOT NULL DEFAULT 'assistant',
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- –¢–∞–±–ª–∏—Ü–∞ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π
CREATE TABLE cars (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    vin TEXT UNIQUE NOT NULL,
    brand TEXT NOT NULL,
    model TEXT NOT NULL,
    year INTEGER NOT NULL,
    status car_status NOT NULL DEFAULT 'active',
    purchase_price DECIMAL(12,2),
    purchase_date DATE,
    sale_price DECIMAL(12,2),
    sale_date DATE,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    CONSTRAINT valid_year CHECK (year >= 1900 AND year <= EXTRACT(YEAR FROM NOW()) + 1),
    CONSTRAINT valid_vin CHECK (LENGTH(vin) = 17),
    CONSTRAINT sale_logic CHECK (
        (status = 'active' AND sale_price IS NULL AND sale_date IS NULL) OR
        (status = 'sold' AND sale_price IS NOT NULL AND sale_date IS NOT NULL)
    )
);

-- –¢–∞–±–ª–∏—Ü–∞ –∫—É—Ä—Å–æ–≤ –≤–∞–ª—é—Ç
CREATE TABLE exchange_rates (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    currency TEXT NOT NULL,
    rate_to_usd DECIMAL(10,6) NOT NULL,
    date DATE NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    UNIQUE(currency, date)
);

-- –¢–∞–±–ª–∏—Ü–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
CREATE TABLE transactions (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    type transaction_type NOT NULL,
    category TEXT NOT NULL,
    amount DECIMAL(12,2) NOT NULL,
    currency TEXT NOT NULL DEFAULT 'USD',
    exchange_rate DECIMAL(10,6) NOT NULL DEFAULT 1.0,
    amount_usd DECIMAL(12,2) NOT NULL,
    description TEXT,
    date DATE NOT NULL,
    car_id UUID REFERENCES cars(id) ON DELETE SET NULL,
    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    is_personal BOOLEAN NOT NULL DEFAULT FALSE,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    CONSTRAINT positive_amount CHECK (amount > 0),
    CONSTRAINT positive_rate CHECK (exchange_rate > 0)
);

-- –¢–∞–±–ª–∏—Ü–∞ –∞—É–¥–∏—Ç–∞
CREATE TABLE audit_log (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    table_name TEXT NOT NULL,
    record_id UUID NOT NULL,
    action TEXT NOT NULL,
    old_values JSONB,
    new_values JSONB,
    user_id UUID REFERENCES users(id),
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- –ò–Ω–¥–µ–∫—Å—ã
CREATE INDEX idx_cars_vin ON cars(vin);
CREATE INDEX idx_cars_status ON cars(status);
CREATE INDEX idx_transactions_date ON transactions(date);
CREATE INDEX idx_transactions_car_id ON transactions(car_id);
CREATE INDEX idx_transactions_user_id ON transactions(user_id);
CREATE INDEX idx_transactions_type ON transactions(type);
CREATE INDEX idx_exchange_rates_currency_date ON exchange_rates(currency, date);
CREATE INDEX idx_audit_log_table_record ON audit_log(table_name, record_id);
\`, '–°–æ–∑–¥–∞–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü')
                
                await new Promise(resolve => setTimeout(resolve, 2000))
                
                // –ú–∏–≥—Ä–∞—Ü–∏—è 2: –¢—Ä–∏–≥–≥–µ—Ä—ã –∏ —Ñ—É–Ω–∫—Ü–∏–∏
                log('‚öôÔ∏è –°–æ–∑–¥–∞–µ–º —Ç—Ä–∏–≥–≥–µ—Ä—ã –∏ —Ñ—É–Ω–∫—Ü–∏–∏...')
                await executeSQL(\`
-- –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è updated_at
CREATE OR REPLACE FUNCTION update_updated_at_column()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = NOW();
    RETURN NEW;
END;
$$ language 'plpgsql';

-- –¢—Ä–∏–≥–≥–µ—Ä—ã –¥–ª—è updated_at
CREATE TRIGGER update_users_updated_at BEFORE UPDATE ON users
    FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

CREATE TRIGGER update_cars_updated_at BEFORE UPDATE ON cars
    FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

CREATE TRIGGER update_transactions_updated_at BEFORE UPDATE ON transactions
    FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

-- –§—É–Ω–∫—Ü–∏—è –∞—É–¥–∏—Ç–∞
CREATE OR REPLACE FUNCTION audit_trigger_function()
RETURNS TRIGGER AS $$
BEGIN
    IF TG_OP = 'DELETE' THEN
        INSERT INTO audit_log (table_name, record_id, action, old_values, user_id)
        VALUES (TG_TABLE_NAME, OLD.id, TG_OP, row_to_json(OLD), OLD.user_id);
        RETURN OLD;
    ELSIF TG_OP = 'UPDATE' THEN
        INSERT INTO audit_log (table_name, record_id, action, old_values, new_values, user_id)
        VALUES (TG_TABLE_NAME, NEW.id, TG_OP, row_to_json(OLD), row_to_json(NEW), NEW.user_id);
        RETURN NEW;
    ELSIF TG_OP = 'INSERT' THEN
        INSERT INTO audit_log (table_name, record_id, action, new_values, user_id)
        VALUES (TG_TABLE_NAME, NEW.id, TG_OP, row_to_json(NEW), NEW.user_id);
        RETURN NEW;
    END IF;
    RETURN NULL;
END;
$$ LANGUAGE plpgsql;

-- –¢—Ä–∏–≥–≥–µ—Ä—ã –∞—É–¥–∏—Ç–∞
CREATE TRIGGER audit_cars_trigger
    AFTER INSERT OR UPDATE OR DELETE ON cars
    FOR EACH ROW EXECUTE FUNCTION audit_trigger_function();

CREATE TRIGGER audit_transactions_trigger
    AFTER INSERT OR UPDATE OR DELETE ON transactions
    FOR EACH ROW EXECUTE FUNCTION audit_trigger_function();

-- –§—É–Ω–∫—Ü–∏—è —Ä–∞—Å—á–µ—Ç–∞ –ø—Ä–∏–±—ã–ª–∏
CREATE OR REPLACE FUNCTION get_profit_distribution()
RETURNS TABLE (
    total_profit DECIMAL(12,2),
    investor_share DECIMAL(12,2),
    owner_share DECIMAL(12,2),
    assistant_share DECIMAL(12,2)
) AS $$
DECLARE
    profit DECIMAL(12,2);
BEGIN
    SELECT COALESCE(SUM(
        CASE 
            WHEN t.type = 'income' THEN t.amount_usd
            WHEN t.type = 'expense' AND NOT t.is_personal THEN -t.amount_usd
            ELSE 0
        END
    ), 0) INTO profit
    FROM transactions t;
    
    RETURN QUERY SELECT 
        profit,
        ROUND(profit * 0.5, 2),
        ROUND(profit * 0.25, 2),
        ROUND(profit * 0.25, 2);
END;
$$ LANGUAGE plpgsql;
\`, '–°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤ –∏ —Ñ—É–Ω–∫—Ü–∏–π')
                
                await new Promise(resolve => setTimeout(resolve, 2000))
                
                // –ú–∏–≥—Ä–∞—Ü–∏—è 3: RLS –ø–æ–ª–∏—Ç–∏–∫–∏
                log('üîí –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (RLS)...')
                await executeSQL(\`
-- –í–∫–ª—é—á–∞–µ–º RLS
ALTER TABLE users ENABLE ROW LEVEL SECURITY;
ALTER TABLE cars ENABLE ROW LEVEL SECURITY;
ALTER TABLE transactions ENABLE ROW LEVEL SECURITY;
ALTER TABLE exchange_rates ENABLE ROW LEVEL SECURITY;
ALTER TABLE audit_log ENABLE ROW LEVEL SECURITY;

-- –ü–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è users
CREATE POLICY "Users can view all profiles" ON users FOR SELECT USING (true);
CREATE POLICY "Users can update own profile" ON users FOR UPDATE USING (auth.uid() = id);

-- –ü–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è cars
CREATE POLICY "Everyone can view cars" ON cars FOR SELECT USING (true);
CREATE POLICY "Owner and assistant can manage cars" ON cars FOR ALL USING (
    EXISTS (
        SELECT 1 FROM users 
        WHERE id = auth.uid() 
        AND role IN ('owner', 'assistant')
    )
);

-- –ü–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è transactions
CREATE POLICY "Everyone can view transactions" ON transactions FOR SELECT USING (true);
CREATE POLICY "Owner can manage all transactions" ON transactions FOR ALL USING (
    EXISTS (
        SELECT 1 FROM users 
        WHERE id = auth.uid() 
        AND role = 'owner'
    )
);
CREATE POLICY "Assistant can manage own transactions" ON transactions FOR ALL USING (
    EXISTS (
        SELECT 1 FROM users 
        WHERE id = auth.uid() 
        AND (role = 'owner' OR (role = 'assistant' AND user_id = auth.uid()))
    )
);

-- –ü–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è exchange_rates
CREATE POLICY "Everyone can view exchange rates" ON exchange_rates FOR SELECT USING (true);
CREATE POLICY "Owner can manage exchange rates" ON exchange_rates FOR ALL USING (
    EXISTS (
        SELECT 1 FROM users 
        WHERE id = auth.uid() 
        AND role = 'owner'
    )
);

-- –ü–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è audit_log
CREATE POLICY "Owner can view audit log" ON audit_log FOR SELECT USING (
    EXISTS (
        SELECT 1 FROM users 
        WHERE id = auth.uid() 
        AND role = 'owner'
    )
);
\`, '–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–ª–∏—Ç–∏–∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏')
                
                await new Promise(resolve => setTimeout(resolve, 2000))
                
                // –ú–∏–≥—Ä–∞—Ü–∏—è 4: –ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è
                log('üìä –°–æ–∑–¥–∞–µ–º –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏...')
                await executeSQL(\`
-- –ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –¥–∞—à–±–æ—Ä–¥–∞
CREATE OR REPLACE VIEW dashboard_stats AS
SELECT 
    (SELECT COUNT(*) FROM cars) as total_cars,
    (SELECT COUNT(*) FROM cars WHERE status = 'active') as active_cars,
    (SELECT COUNT(*) FROM cars WHERE status = 'sold') as sold_cars,
    (SELECT COALESCE(SUM(amount_usd), 0) FROM transactions WHERE type = 'income') as total_income,
    (SELECT COALESCE(SUM(amount_usd), 0) FROM transactions WHERE type = 'expense' AND NOT is_personal) as total_expenses,
    (SELECT COALESCE(SUM(CASE WHEN type = 'income' THEN amount_usd WHEN type = 'expense' AND NOT is_personal THEN -amount_usd ELSE 0 END), 0) FROM transactions) as total_profit,
    (SELECT COALESCE(SUM(amount_usd), 0) FROM transactions WHERE type = 'income' AND date >= DATE_TRUNC('month', CURRENT_DATE)) as monthly_income,
    (SELECT COALESCE(SUM(amount_usd), 0) FROM transactions WHERE type = 'expense' AND NOT is_personal AND date >= DATE_TRUNC('month', CURRENT_DATE)) as monthly_expenses,
    (SELECT COALESCE(SUM(CASE WHEN type = 'income' THEN amount_usd WHEN type = 'expense' AND NOT is_personal THEN -amount_usd ELSE 0 END), 0) FROM transactions WHERE date >= DATE_TRUNC('month', CURRENT_DATE)) as monthly_profit;

-- –ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –º–µ—Å—è—á–Ω–æ–π —Å–≤–æ–¥–∫–∏
CREATE OR REPLACE VIEW monthly_summary AS
SELECT 
    TO_CHAR(date, 'YYYY-MM') as month,
    SUM(CASE WHEN type = 'income' THEN amount_usd ELSE 0 END) as total_income,
    SUM(CASE WHEN type = 'expense' AND NOT is_personal THEN amount_usd ELSE 0 END) as total_expenses,
    SUM(CASE WHEN type = 'expense' AND is_personal THEN amount_usd ELSE 0 END) as personal_expenses,
    SUM(CASE WHEN type = 'income' THEN amount_usd WHEN type = 'expense' AND NOT is_personal THEN -amount_usd ELSE 0 END) as net_profit,
    COUNT(*) as transaction_count,
    COUNT(DISTINCT car_id) as cars_involved
FROM transactions
GROUP BY TO_CHAR(date, 'YYYY-MM')
ORDER BY month DESC;

-- –ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –∞–Ω–∞–ª–∏–∑–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
CREATE OR REPLACE VIEW category_analysis AS
SELECT 
    type,
    category,
    COUNT(*) as transaction_count,
    SUM(amount_usd) as total_amount,
    AVG(amount_usd) as average_amount,
    MIN(amount_usd) as min_amount,
    MAX(amount_usd) as max_amount,
    MIN(date) as first_transaction,
    MAX(date) as last_transaction
FROM transactions
GROUP BY type, category
ORDER BY total_amount DESC;

-- –ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–±—ã–ª—å–Ω–æ—Å—Ç–∏ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π
CREATE OR REPLACE VIEW car_profitability AS
SELECT 
    c.id,
    c.vin,
    c.brand,
    c.model,
    c.year,
    c.status,
    c.purchase_price,
    c.sale_price,
    COALESCE(SUM(CASE WHEN t.type = 'income' THEN t.amount_usd ELSE 0 END), 0) as total_income,
    COALESCE(SUM(CASE WHEN t.type = 'expense' THEN t.amount_usd ELSE 0 END), 0) as total_expenses,
    COALESCE(SUM(CASE WHEN t.type = 'income' THEN t.amount_usd WHEN t.type = 'expense' THEN -t.amount_usd ELSE 0 END), 0) as net_profit,
    COUNT(t.id) as transaction_count
FROM cars c
LEFT JOIN transactions t ON c.id = t.car_id
GROUP BY c.id, c.vin, c.brand, c.model, c.year, c.status, c.purchase_price, c.sale_price
ORDER BY net_profit DESC;
\`, '–°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏')
                
                await new Promise(resolve => setTimeout(resolve, 2000))
                
                // –î–æ–±–∞–≤–ª—è–µ–º –∫—É—Ä—Å—ã –≤–∞–ª—é—Ç
                log('üí± –î–æ–±–∞–≤–ª—è–µ–º –±–∞–∑–æ–≤—ã–µ –∫—É—Ä—Å—ã –≤–∞–ª—é—Ç...')
                const today = new Date().toISOString().split('T')[0]
                await executeSQL(\`
INSERT INTO exchange_rates (currency, rate_to_usd, date) VALUES
('EUR', 1.08, '\${today}'),
('GBP', 1.25, '\${today}'),
('RUB', 0.011, '\${today}'),
('UZS', 0.000081, '\${today}'),
('KZT', 0.0021, '\${today}')
ON CONFLICT (currency, date) DO UPDATE SET
rate_to_usd = EXCLUDED.rate_to_usd;
\`, '–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫—É—Ä—Å–æ–≤ –≤–∞–ª—é—Ç')
                
                log('üéâ –ú–∏–≥—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!', 'success')
                log('‚úÖ –í—Å–µ —Ç–∞–±–ª–∏—Ü—ã, —Ñ—É–Ω–∫—Ü–∏–∏ –∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Å–æ–∑–¥–∞–Ω—ã', 'success')
                log('üîó –û—Ç–∫—Ä–æ–π—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç: https://xixjtczhnyggwotkvbhh.supabase.co', 'success')
                log('üìä –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–∞–±–ª–∏—Ü—ã –≤ Table Editor', 'success')
                log('üöÄ –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ: npm run dev', 'success')
                
            } catch (error) {
                log(\`‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: \${error.message}\`, 'error')
            } finally {
                btn.disabled = false
                btn.textContent = '–ó–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é'
            }
        }
    </script>
</body>
</html>
